<!DOCTYPE html>
<html lang="ca">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Recuperar contrasenya — FibERP</title>
    <meta
      name="description"
      content="Pàgina per recuperar la contrasenya de FibERP, moderna i responsiva."
    />
    <link rel="stylesheet" href="../css/style.css" />
  </head>
  <body>
    <main class="container" role="main">
      <section class="hero fade-up" aria-hidden="false">
        <div class="brand">
          <div class="logo" aria-hidden="true">FibERP</div>
        </div>
        <h1>Recupera la contrasenya</h1>
        <p class="lead">
          Introdueix el teu correu electrònic i t’enviarem un enllaç per
          restablir la contrasenya.
        </p>
        <footer class="small">
          Recordes la contrasenya?
          <a
            href="login.html"
            style="color: var(--accent); text-decoration: none"
            >Inicia sessió</a
          >
        </footer>
      </section>

      <aside
        class="card fade-up"
        aria-label="Formulari de recuperació de contrasenya"
      >
        <form id="forgotForm" novalidate>
          <div>
            <label for="email">Correu electrònic</label>
            <input
              id="email"
              name="email"
              type="email"
              placeholder="tu@empresa.com"
              required
              aria-required="true"
            />
            <div
              class="error"
              id="emailError"
              aria-live="polite"
              style="display: none"
            ></div>
          </div>

          <button class="btn" type="submit" id="submitBtn">
            Enviar enllaç
          </button>
        </form>
      </aside>
    </main>

    <script>
      (function () {
        const form = document.getElementById("forgotForm");
        const email = document.getElementById("email");
        const emailError = document.getElementById("emailError");
        const submitBtn = document.getElementById("submitBtn");

        function showError(el, msg) {
          el.textContent = msg;
          el.style.display = "block";
        }
        function clearError(el) {
          el.textContent = "";
          el.style.display = "none";
        }

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          clearError(emailError);

          if (!email.value || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email.value)) {
            showError(emailError, "Introdueix un correu vàlid.");
            return;
          }

          submitBtn.disabled = true;
          submitBtn.textContent = "Enviant...";

          try {
            // Aquí cridaràs al teu endpoint de backend per enviar correu de recuperació
            const response = await fetch(
              "http://localhost:8000/forgot-password",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email: email.value }),
              }
            );

            const data = await response.json();

            if (response.ok) {
              alert("Enllaç enviat correctament al teu correu electrònic.");
            } else {
              alert(data.message || "No s'ha pogut enviar l'enllaç.");
            }
          } catch (err) {
            console.error(err);
            alert("Error de xarxa, intenta-ho de nou.");
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = "Enviar enllaç";
          }
        });
      })();
    </script>
  </body>
</html>
